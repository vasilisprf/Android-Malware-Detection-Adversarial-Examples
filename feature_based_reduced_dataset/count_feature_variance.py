import os
import csv
import pandas as pd
feature_vector = {}  # dictionary with indexes mapped to features
index = 0  # index value

feature_vectors_dir = '../new_feature_vectors/'
new_feature_vectors_dir = 'more_new_feature_vectors/'
csv_file = "../feature_variances.csv"

if not os.path.exists(new_feature_vectors_dir):
    os.makedirs(new_feature_vectors_dir)


def export_to_csv():
    not_assignable_feature_type = ['']  # found from extract_feature_types.py
    features_variance = {}

    for filename in os.listdir(feature_vectors_dir):  # read all apps
        with open(feature_vectors_dir + filename, "r") as file:  # open an app
            for line in file:  # read app line by line

                line = line.strip()  # remove whitespace chars
                if line not in not_assignable_feature_type:  # check if feature type is ''
                    if line not in features_variance:
                        features_variance[line] = 1
                    else:
                        features_variance[line] += 1

    print(len(features_variance))

    with open(csv_file, 'w', newline="") as csvfile:
        writer = csv.writer(csvfile)
        writer.writerow(["Feature", "Variance"])
        for key, value in features_variance.items():
            writer.writerow([key, value])

def export_eliminated_csv():
    df = pd.read_csv(csv_file)
    #print(df.head(3))
    #print(df.sort_values('Variance'))
    drop = (df[df.Variance >= 5])
    print(len(drop))
    export_to_csv = drop.to_csv("eliminated_variance.csv", index=None, header=True)



if __name__ == "__main__":
    #export_to_csv()
    export_eliminated_csv()










