"""
This file counts the amount of features that belong to each class.
"""
import os

# predefined dictionary with keys the feature types found from extract_feature_types.py
features_types = {
    "provider": 1,
    "permission": 2,
    "activity": 3,
    "service_receiver": 4,
    "intent": 5,
    "call": 6,
    "real_permission": 7,
    "api_call": 8,
    "url": 9,
    "feature": 10
}

feature_vector = {}
features_occurrences = {x: 0 for x in range(1, 11)}  # we have 10 feature types
# print(features_occurrences)
feature_vectors_dir = '../feature_vectors/'  # directory with features for all apps

not_assignable_feature_type = ['']  # found from extract_feature_types.py
print("Counting features for each class...")
for filename in os.listdir(feature_vectors_dir):  # read all apps
    with open(feature_vectors_dir + filename, "r") as file:  # open an app
        for line in file:  # read app line by line
            feature_type = line[:line.find('::')]  # extract feature type
            feature = line.strip()  # remove whitespace chars
            if feature_type not in not_assignable_feature_type:  # check if feature type is ''
                # if a feature is not present in the feature vector: map feature to index and increment index
                if feature not in feature_vector:
                    feature_vector[feature] = 1  # append feature to dictionary
                    temp = features_types.get(feature_type, None)  # get the corresponding value from the predefined dict
                    features_occurrences[temp] += 1  # increment index

print(features_occurrences)
#print(len(feature_vector))
print("Total unique features present in dataset: ", sum(features_occurrences.values()))

"""
{1: 4513, 2: 3812, 3: 185729, 4: 33222, 5: 6379, 6: 733, 7: 70, 8: 315, 9: 310488, 10: 72}
Total features present in dataset:  545333

Category     Type              Amount
S1         provider            4513
S2         permission          3812
S3         activity            185729
S3         service_receiver    33222
S4         intent              6379
S5         call                733
S6         real_permission     70
S7         api_call            315
S8         url                 310488
-          feature             72        
"""
