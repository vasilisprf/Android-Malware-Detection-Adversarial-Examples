import os
import csv

feature_vectors_dir = '../feature_vectors/'  # directory with features for all apps
csv_malware = "../sha256_family.csv"  # csv file with malwares
features = 0
malware_features = 0
benign_features = 0
malware = []
not_assignable_feature_type = ['']  # found from extract_feature_types.py


def count_features_in_apps():
    global features
    print("Counting features in apps...")
    for filename in os.listdir(feature_vectors_dir):
        with open(feature_vectors_dir + filename, "r") as file:
            for line in file:
                feature_type = line[:line.find('::')]
                line.strip()
                if feature_type not in not_assignable_feature_type:
                    features += 1
    print("Total features present in apps: ", features)  # 6113102


def count_features_in_malware():
    global malware_features
    print("\nCounting features in malware apps...")

    with open(csv_malware, 'r') as file:  # open malware csv file
        next(file)  # skip the header line
        reader = csv.reader(file, delimiter=',')  # read the csv
        for row in reader:
            malware.append(row[0])  # append every SHA name from the csv file into a list

    for filename in os.listdir(feature_vectors_dir):
        if filename in malware:
            with open(feature_vectors_dir + filename, "r") as file:
                for line in file:
                    # extract feature
                    feature_type = line[:line.find('::')]
                    line.strip()
                    if feature_type not in not_assignable_feature_type:
                        malware_features += 1

    print("Total features present in malware: ", malware_features)
    print("Mean of features in malware: ", malware_features / 5560)


def count_features_in_benign():
    print("\nCounting features in benign apps...")
    global benign_features
    for filename in os.listdir(feature_vectors_dir):  # read all app's SHA names
        if filename not in malware:
            with open(feature_vectors_dir + filename, "r") as file:
                for line in file:
                    # extract feature
                    feature_type = line[:line.find('::')]
                    if feature_type not in not_assignable_feature_type:
                        benign_features += 1

    print("Total unique features present in benign apps: ", benign_features)
    print("Mean of features in benign apps: ", benign_features / 123453)


count_features_in_apps()
count_features_in_malware()
count_features_in_benign()
